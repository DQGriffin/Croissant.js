<html>
    <head>
        <title>Croissant</title>
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

        <style>
			@import url('https://fonts.googleapis.com/css?family=Roboto');

			body {
				font-family: Roboto;
			}
            .cont {
                width: 50%;
                height: 50%;
            }
            a {
                text-decoration: none;
            }

            a:visited {
                text-decoration: none;
            }

            a:hover {
                text-decoration: none;
            }

            a:active {
                text-decoration: none;
            }

            a:link {
                text-decoration: none;
            }

            .checkbox-label {
                display: inline-block;
                user-select: none;
                -webkit-user-select: none;
                -moz-user-select: none;
                padding-left: 5px;
                width: calc(100% - 30px);
            }

            .filter-item {
                padding-left: 5px;
                padding-bottom: 5px;
            }

            .filter-item:hover {
                background-color: #ccc;
            }

            .hidden {
                display: none;
            }

            .selection-button {
                margin-top: 3px;
            }

            .filter-dropdown {
                max-height: 450px;
                overflow-y: auto;
            }
        </style>

        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-K9PZGNBVML"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-K9PZGNBVML');
        </script>

        <script>
            window.onload=function(){
                // Add event listeners
                let createMenuFilepicker = document.getElementById("create-menu-file-upload")
                let updateMenuFilepicker = document.getElementById("update-menu-file-upload")
                const selectAllCheckbox = document.getElementById('select-all-checkbox')

                createMenuFilepicker.addEventListener('change', (e) => {
                    const [file] = e.target.files

                    // If the file is a CSV, read the Page names and populate the filter box
                    if (file.name.includes(".csv")) {
                        document.getElementById("site-filter").classList.remove("hidden")
                        clearFilters()
                        readPageNames(file)
                    }
                    else {
                        document.getElementById("site-filter").classList.add("hidden")
                    }

                    // Set the label text to the filename
                    let fileNameLabel = document.getElementById("create-menu-filename")
                    fileNameLabel.innerHTML = file.name
                    gtag('event', 'create-menu', {
                    'event_category' : 'dowloads',
                    'event_label' : file.name
                    });
                })

                updateMenuFilepicker.addEventListener('change', (e) => {
                    const [file] = e.target.files
                    let updateMenuLabel = document.getElementById("update-menu-filename")
                    updateMenuLabel.innerHTML = file.name
                    gtag('event', 'update-audit', {
                    'event_category' : 'dowloads',
                    'event_label' : file.name
                    });
                })

                window.addEventListener('mouseup', (e) => {
                    const filterBox = document.getElementById('filterBox')
                    const filterButton = document.getElementById('filterButton')

                    if (e.target != filterButton && !filterBox.contains(e.target)) {
                        filterBox.classList.remove("w3-show")
                    }
                })

                selectAllCheckbox.addEventListener('change', (e) => {
                    if (selectAllCheckbox.checked) {
                        setAllSiteFilters(true)
                    }
                    else {
                        setAllSiteFilters(false)
                    }
                })
            }

            function clearFilters() {
                let div = document.getElementById("filterBox")

                while (div.childNodes.length > 5) {
                    div.removeChild(div.lastChild)
                }
            }

            function readPageNames(file) {
                let reader = new FileReader()

                reader.onload = function() {
                    //console.log(reader.result);
                    let rows = reader.result.split("\n")
                    for (let index = 0; index < rows.length; index++) {
                        let elements = rows[index].split(",")
                        if (elements.length >= 12 && elements[1] == "Page") {
                            let filterBox = document.getElementById("filterBox")

                            var div = document.createElement('div');
                            div.classList.add('filter-item')

                            var checkbox = document.createElement('input');
                            checkbox.type = 'checkbox';
                            checkbox.id = elements[11]
                            checkbox.name = 'page';
                            checkbox.value = elements[11]
                            checkbox.classList.add("w3-check")
                            checkbox.classList.add("site-filter-check")
                            checkbox.checked = true
                            addClickListener(checkbox)

                            let label = document.createElement("label")
                            label.innerHTML = elements[11]
                            label.htmlFor = elements[11]
                            label.classList.add("checkbox-label")
                            div.appendChild(checkbox)
                            div.appendChild(label)
                            filterBox.appendChild(div)
                        }
                    }
                };
                
                reader.readAsText(file)
            }

            function addClickListener(checkbox) {
                checkbox.addEventListener('click', (e) => {
                    if (isEverySiteSelected()) {
                        document.getElementById('select-all-checkbox').checked = true
                    }
                    else {
                        document.getElementById('select-all-checkbox').checked = false
                    }
                })
            }

            function isEverySiteSelected() {
                const siteFilters = document.getElementsByClassName('site-filter-check')
                for (let index = 0; index < siteFilters.length; index++) {
                    if (!siteFilters[index].checked) {
                        return false
                    }
                }
                return true
            }

            function openOption(evt, optionName) {
            var i, x, tablinks;
            x = document.getElementsByClassName("navigation-option");
            for (i = 0; i < x.length; i++) {
                x[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablink");
            for (i = 0; i < x.length; i++) {
                tablinks[i].classList.remove("w3-red");
            }
            document.getElementById(optionName).style.display = "block";
            evt.currentTarget.classList.add("w3-red");
            }

            function clickElementWithID(id) {
                document.getElementById(id).click();
            }

            // Dropdown
            function dropFunction() {
            var x = document.getElementById("filterBox");
            if (x.className.indexOf("w3-show") == -1) {
                x.className += " w3-show";
            } else {
                x.className = x.className.replace(" w3-show", "");
            }
            }

            // Filter
            function filterFunction() {
            var input, filter, ul, li, a, i;
            input = document.getElementById("myInput");
            filter = input.value.toUpperCase();
            div = document.getElementById("filterBox");
            a = div.getElementsByClassName('filter-item')
            for (i = 0; i < a.length; i++) {
                txtValue = a[i].getElementsByClassName('checkbox-label')[0].innerHTML
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    a[i].style.display = "";
                } else {
                    a[i].style.display = "none";
                }
            }
            }

            function setAllSiteFilters(value) {
                let checkboxes = document.getElementsByClassName("w3-check")

                for (let index = 0; index < checkboxes.length; index++) {
                    checkboxes[index].checked = value
                }
            }
        </script>
    </head>
    <body>
        <div class = "cont">
            <div class="w3-sidebar w3-bar-block w3-light-grey w3-card" style="width:230px">
                <div class="w3-container">
                  <h5>Croissant&#8482;</h5>
                </div>
                <a href="javascript:void(0)" class="w3-bar-item w3-button tablink testbtn w3-red" onclick="openOption(event, 'create-menus')">Create Menus</a>
                <a href="javascript:void(0)" class="w3-bar-item w3-button tablink" onclick="openOption(event, 'update-menus')">Audit Menus</a>
              </div>
              
              <div style="margin-left:230px">
              
                <div id="create-menus" class="w3-container navigation-option">
                    <h2>Create Menus</h2>
                    <form action="fileupload" method="post" enctype="multipart/form-data">
                        <input hidden id="create-menu-file-upload" type="file" name="filetoupload" accept=".xlsx, .xml, .csv">
                        <button type="button" style="width: 20%" class="w3-button w3-white w3-border w3-round-large" onclick="clickElementWithID('create-menu-file-upload')">Browse...</button>
                        <p style="display: inline-block; padding-left: 5px; padding-right: 20px;" id="create-menu-filename">No file chosen</p>
                        <div class="w3-dropdown-click hidden" id="site-filter">
                            <button type="button" class="w3-button w3-white w3-border w3-round-large" id="filterButton" onclick="dropFunction()">Filter Site(s)</button>
                            <div class="w3-dropdown-content w3-bar-block w3-card w3-light-grey filter-dropdown" style="width: 210px;" id="filterBox">
                              <input class="w3-input w3-padding" type="search" placeholder="Search.." id="myInput"  oninput="filterFunction()" autocomplete="off">
                              <div class="filter-item">
                                <input type="checkbox" id="select-all-checkbox" class="w3-check" checked>
                                <label for="select-all-checkbox" class="checkbox-label" style="margin-left: -4px;">Select all</label>
                              </div>
                            </div>
                        </div>
                        <input class="w3-button w3-white w3-border w3-round-large" type="submit">
                    </form>
                    <br>
                    <p><b>Instructions</b></p>
                    <p><b>Building from the BRD</b></p>
                    <p>1. Export the BRD as an Excel file</p>
                    <p>2. Upload the file into Croissant</p>
                    <p>3. Check your downloads folder for the auto-generated XML file</p>
                    <p>4. Upload the file in Service Web under Phone System > Auto-Receptionist > IVR Editor > Import</p>
                    <p><b>Building from Lucidchart</b></p>
                    <p>1. Export the Lucidchart, choosing CSV of Shape Data</p>
                    <p>2. Click the browse button to select the file</p>
                    <p>3. Optionally, filter out sites that you do not want to build</p>
                    <p>4. Click 'Submit'</p>
                    <p>5. Upload the generated XML file in Service Web under Phone System > Auto-Receptionist > IVR Editor > Import</p>
                    <p><b>Resources</b></p>
                    <a href="https://docs.google.com/document/d/1xcF5H6KHnn-UF_vgAq7LEKJBa-g4XKBY3YvH0or-9HQ/edit?usp=sharing" target="_blank">Documentation</a>
                    <img src="link.png" style="width:10px;height:10px;">
                    <br>
                    <a href="https://docs.google.com/spreadsheets/d/1mEaZVjjmesskNf47Dz0jMgPgZDKZ13PISgqiNyyMNos/edit?usp=sharing" target="_blank">Example BRD</a>
                    <img src="link.png" style="width:10px;height:10px;">
                    <br>
                    <a href="https://lucid.app/lucidchart/51421e0f-912e-47ca-a063-59d43cf436fd/edit?viewport_loc=-1505%2C-1165%2C5370%2C2692%2C0_0&invitationId=inv_50c4ff9e-896f-4ddc-b3df-ccd0251074b5#" target="_blank">Example Lucidchart</a>
                    <img src="link.png" style="width:10px;height:10px;">
                </div>
              
                <div id="update-menus" style="display:none" class="w3-container navigation-option">
                    <h2>Audit Menus</h2>
                    <form action="audit" method="post" enctype="multipart/form-data">
                        <input hidden id="update-menu-file-upload" type="file" name="filetoupload" accept=".xml">
                        <button type="button" style="width: 20%" class="w3-button w3-white w3-border w3-round-large" onclick="clickElementWithID('update-menu-file-upload')">Browse...</button>
                        <p style="display: inline-block; padding-left: 5px; padding-right: 20px;" id="update-menu-filename">No file chosen</p>
                        <input class="w3-button w3-white w3-border w3-round-large" type="submit">
                    </form>
                    <br>
                    <p><b>Instructions</b></p>
                    <p>1. Export an XML file from Service Web under Phone System > Auto-Receptionist > IVR Editor > Export</p>
                    <p>2. Upload the file into Croissant</p>
                    <p>3. Open the generated Excel file</p>
                    <p><b>Resources</b></p>
                    <a href="https://docs.google.com/document/d/1xcF5H6KHnn-UF_vgAq7LEKJBa-g4XKBY3YvH0or-9HQ/edit?usp=sharing" target="_blank">Documentation</a>
                    <img src="link.png" style="width:10px;height:10px;">
                </div>
              
              </div>
        </div>
    </body>
</html>